version: 2

models:
  # ADDRESSES
  - name: stg_sqlserver__addresses
    description: >
      This model represents the staging table for addresses data imported from SQL Server.
      It includes details on address, country, state, and related metadata.
    config:
      materialized: view
      columns:
        - name: ADDRESS_ID
          tests:
            - not_null
            - unique
        - name: ZIPCODE
          tests:
            - not_null
        - name: COUNTRY
          tests:
            - not_null
        - name: ADDRESS
          tests:
            - not_null
        - name: STATE
          tests:
            - not_null
        - name: _FIVETRAN_DELETED
          tests:
            - not_null
            - type: boolean
        - name: _FIVETRAN_SYNCED_UTC
          data_type: timestamp_tz
          description: >
            The timestamp when Fivetran synchronized the data in UTC time zone.
  # EVENTS
  - name: stg_sqlserver__events
    description: >
      This model represents the staging table for events data imported from SQL Server.
      It includes details on event type, user, product, session, and related metadata.
    config:
      contract:
        enforced: true
    columns:
      - name: EVENT_ID
        data_type: text
        description: >
          Unique identifier for each event.
        constraints:
          - type: not_null
        tests:
          - not_null
          - unique
      - name: PAGE_URL
        data_type: text
        description: >
          URL of the page where the event occurred.
        constraints:
          - type: not_null
        tests:
          - not_null
      - name: EVENT_TYPE
        data_type: text
        description: >
          Type of the event (e.g., checkout, view).
        constraints:
          - type: not_null
        tests:
          - not_null
      - name: USER_ID
        data_type: text
        description: >
          Identifier of the user who triggered the event.
        constraints:
          - type: not_null
        tests:
          - not_null
      - name: PRODUCT_ID
        data_type: text
        description: >
          Identifier of the product related to the event.
      - name: SESSION_ID
        data_type: text
        description: >
          Identifier of the session in which the event occurred.
        constraints:
          - type: not_null
        tests:
          - not_null
      - name: CREATED_AT
        data_type: timestamp
        description: >
          Timestamp when the event was created.
        constraints:
          - type: not_null
        tests:
          - not_null
      - name: ORDER_ID
        data_type: text
        description: >
          Identifier of the order related to the event.
      - name: _FIVETRAN_DELETED
        data_type: boolean
        description: >
          Indicates if the record was marked as deleted by Fivetran.
      - name: _FIVETRAN_SYNCED_UTC
        data_type: timestamp_tz
        description: >
          The timestamp when Fivetran synchronized the data in UTC time zone.

  # ORDERS ITEMS
  - name: stg_sqlserver__order_items
    description: >
      This model represents the staging table for order items data imported from SQL Server.
      It includes details on order ID, product ID, quantity, and related metadata.
    config:
      contract:
        enforced: true
    columns:
      - name: ORDER_ID
        data_type: text
        description: >
          Unique identifier for each order.
        constraints:
          - type: not_null
        tests:
          - not_null
      - name: PRODUCT_ID
        data_type: text
        description: >
          Unique identifier for each product.
        constraints:
          - type: not_null
        tests:
          - not_null
      - name: QUANTITY
        data_type: integer
        description: >
          Quantity of the product in the order.
        constraints:
          - type: not_null
        tests:
          - not_null
          - positive_values
      - name: _FIVETRAN_DELETED
        data_type: boolean
        description: >
          Indicates if the record was marked as deleted by Fivetran.
      - name: _FIVETRAN_SYNCED_UTC
        data_type: timestamp_tz
        description: >
          The timestamp when Fivetran synchronized the data in UTC time zone.

  # ORDERS
  - name: stg_sqlserver__orders
    description: >
      This model represents the staging table for orders data imported from SQL Server.
      It includes details on order ID, shipping, costs, user, and related metadata.
    config:
      contract:
       enforced: true
    columns:
    - name: ORDER_ID
      data_type: text
      description: >
        Unique identifier for each order.
      constraints:
        - type: not_null
      tests:
        - not_null
        - unique
    - name: SHIPPING_SERVICE_ID
      data_type: text
      description: >
         Shipping service id.
    - name: SHIPPING_COST_AMOUNT_EURO
      data_type: float
      description: >
        Cost of shipping the order in Euro.
    - name: ADDRESS_ID
      data_type: text
      description: >
        Identifier of the address where the order is delivered.
      constraints:
        - type: not_null
      tests:
        - not_null
    - name: CREATED_AT
      data_type: timestamp_tz
      description: >
        Timestamp when the order was created.
      constraints:
        - type: not_null
      tests:
        - not_null
    - name: PROMO_ID
      data_type: text
      description: >
        Identifier of the promotion applied to the order.
    - name: ESTIMATED_DELIVERY_AT
      data_type: timestamp_tz
      description: >
        Estimated delivery time of the order.
    - name: ORDER_COST_EURO
      data_type: float
      description: >
        Cost of the order before shipping and promotions.
      constraints:
        - type: not_null
      tests:
        - not_null
    - name: USER_ID
      data_type: text
      description: >
        Identifier of the user who placed the order.
      constraints:
        - type: not_null
      tests:
        - not_null
    - name: ORDER_TOTAL_EURO
      data_type: float
      description: >
        Total cost of the order after shipping and promotions.
      constraints:
        - type: not_null
      tests:
        - not_null
        - positive_values
    - name: DELIVERED_AT
      data_type: timestamp_tz
      description: >
        Timestamp when the order was delivered.
    - name: TRACKING_ID
      data_type: text
      description: >
        Tracking identifier for the order shipment.
    - name: STATUS_ID
      data_type: text
      description: >
        Identifier of the status.
    - name: USER_ID
      data_type: text
      description: >
        Identifier of the user who placed the order.
    - name: _FIVETRAN_DELETED
      data_type: boolean
      description: >
        Indicates if the record was marked as deleted by Fivetran.
    - name: _FIVETRAN_SYNCED_UTC
      data_type: timestamp_tz
      description: >
        The timestamp when the data was synchronized by Fivetran, converted to UTC.

  # PROMOS
  - name: stg_sqlserver__promos
    description: >
      This model represents the staging table for promotions data imported from SQL Server.
      It includes details on promotion ID, discount amount, status, and related metadata.
    config:
      contract:
        enforced: true
    columns:
      - name: PROMO_ID
        data_type: text
        description: >
          Unique identifier for each promotion, hashed using md5.
        constraints:
          - type: not_null
        tests:
          - not_null
          - unique
      - name: PROMO_NAME
        data_type: text
        description: >
          Promo name.
        constraints:
          - type: not_null
        tests:
          - not_null
      - name: DISCOUNT_EURO
        data_type: int
        description: >
          Amount of discount provided by the promotion.
        constraints:
          - type: not_null
        tests:
          - not_null
      - name: STATUS
        data_type: int
        description: >
          Status of the promotion (e.g., active, inactive).
        constraints:
          - type: not_null
        tests:
          - not_null
      - name: _FIVETRAN_DELETED
        data_type: boolean
        description: >
          Indicates if the record was marked as deleted by Fivetran.
      - name: _FIVETRAN_SYNCED_UTC
        data_type: timestamp_tz
        description: >
          The timestamp when the data was synchronized by Fivetran, converted to UTC.

  # USERS
  - name: stg_sqlserver__users
    description: "Silver layer transformation of the users table"
    columns:
      - name: USER_ID
        description: >
          Unique identifier for the user
        data_type: varchar
        tests:
          - unique
          - not_null
      - name: UPDATED_AT
        description: >
          Timestamp of the last update
        data_type: timestamp with time zone
      - name: ADDRESS_ID
        description: >
          Unique identifier for the address
        data_type: varchar
      - name: LAST_NAME
        description: >
          Last name of the user
        data_type: varchar
      - name: CREATED_AT
        description: >
          Timestamp of the creation of the record
        data_type: timestamp with time zone
      - name: PHONE_NUMBER
        description: >
          Phone number of the user
        data_type: varchar
      - name: IS_VALID_PHONE_NUMBER
        description: >
          Check if the phone number is correct.
        data_type: boolean
      - name: TOTAL_ORDERS
        description: >
          Total number of orders placed by the user
        data_type: numeric
      - name: FIRST_NAME
        description: >
          First name of the user
        data_type: varchar
      - name: EMAIL
        description: >
          Email address of the user
        data_type: varchar
      - name: IS_VALID_EMAIL_ADDRESS
        description: >
          Check if the email is correct.
        data_type: boolean
      - name: _FIVETRAN_DELETED
        description: >
          Flag indicating if the record was deleted in Fivetran
        data_type: boolean
      - name: _FIVETRAN_SYNCED_UTC
        data_type: timestamp_tz
        description: >
          The timestamp when Fivetran synchronized the data in UTC time zone.
  
  #PRODUCTS
  - name: stg_sqlserver__product
    description: "Model for the product table"
    columns:
      - name: PRODUCT_ID
        description: "Unique product identifier"
        tests:
          - unique
          - not_null
      - name: PRICE_EURO
        description: "Price of the product in euro"
        tests:
          - positive_values
      - name: PRODUCT_NAME
        description: "Product name"
      - name: INVENTORY
        description: "Amount of inventory available"
        tests:
          - positive_values
      - name: _FIVETRAN_DELETED
        description: >
          Flag indicating if the record was deleted in Fivetran
        data_type: boolean
      - name: _FIVETRAN_SYNCED_UTC
        data_type: timestamp_tz
        description: >
          The timestamp when Fivetran synchronized the data in UTC time zone.

  #dim_time
  - name: dim_time
    description: "Dimension table representing time"
    columns:
      - name: date
      - name: year
      - name: month
      - name: month_name
      - name: day
      - name: number_week_day
      - name: week_day
      - name: quarter
    config:
      materialized: table
  
